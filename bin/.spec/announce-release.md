# announce-release.sh

Create a file in the current directory (bin/) called `announce-release.sh`, which is a bash script that announces a new release to various notification channels.

## Purpose

This script handles the announcement of a new release by formatting and sending notifications through configured channels. It ensures consistent messaging across all announcement platforms.

## Implementation

```bash
#!/bin/bash
set -euo pipefail

# Usage message
usage() {
    echo "Usage: $0 <release-version>"
    echo "Announces a release through configured channels"
    echo
    echo "Environment variables:"
    echo "  MAIL_TO      Email addresses for announcements (comma-separated)"
    echo "  MAIL_FROM    Sender email address"
    echo "  SMTP_SERVER  SMTP server for sending mail"
    exit 1
}

[ $# -ne 1 ] && usage

RELEASE_VERSION="$1"

# Validate release version format
if ! echo "$RELEASE_VERSION" | grep -qE '^v[0-9]+\.[0-9]+\.[0-9]+$'; then
    echo "Error: Release version must be in format vX.Y.Z"
    exit 1
fi

# Verify release exists
if [ ! -f "releases/notes-${RELEASE_VERSION}.md" ]; then
    echo "Error: Release notes not found. Run publish-release.sh first."
    exit 1
fi

# Format announcement message
ANNOUNCEMENT=$(cat <<EOF
New Release: Pyx Julee ${RELEASE_VERSION}

A new version of Pyx Julee has been released.

Release Notes:
$(cat "releases/notes-${RELEASE_VERSION}.md")

For more information, visit:
https://github.com/your-org/pyx-julee/releases/tag/${RELEASE_VERSION}
EOF
)

# Send email if configured
if [ -n "${MAIL_TO:-}" ] && [ -n "${MAIL_FROM:-}" ] && [ -n "${SMTP_SERVER:-}" ]; then
    echo "Sending announcement email..."
    echo "$ANNOUNCEMENT" | mail -s "Pyx Julee ${RELEASE_VERSION} Released" \
        -r "$MAIL_FROM" -S smtp="$SMTP_SERVER" "$MAIL_TO"
fi

# Log announcement to stdout
echo "Release announcement:"
echo "===================="
echo "$ANNOUNCEMENT"
echo "===================="

echo "Release announcement complete"
```

## Usage

```bash
# With email configuration
MAIL_TO="users@example.com" \
MAIL_FROM="releases@example.com" \
SMTP_SERVER="smtp.example.com" \
./announce-release.sh v2.1.0

# Without email (just logs to stdout)
./announce-release.sh v2.1.0
```

## Exit Codes

- 0: Announcement sent successfully
- 1: Error occurred (invalid input, missing files, etc.)

## Dependencies

Requires:
- git
- mail command (for email announcements)
- releases/notes-{version}.md files from publish-release.sh

## Notes

- Uses release notes generated by publish-release.sh
- Supports email notifications via environment variables
- Can be extended to support additional notification channels
- Provides consistent formatting across all channels
